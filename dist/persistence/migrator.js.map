{"version":3,"sources":["../../src/persistence/migrator.js"],"names":["chain","S","dbName","process","env","PGDATABASE","dbParams","database","user","PGUSER","password","PGPASSWORD","host","PGHOST","port","Number","PGPORT","migrationPath","createDb","Future","encaseP2","Migrations","migrate","migration","fork","error","console","log"],"mappings":";;AAAA;;;;AACA;;;;AAEA,MAAM,EAAEA,KAAF,KAAYC,MAAlB;;AAEA,MAAMC,SAASC,QAAQC,GAAR,CAAYC,UAA3B;;AAEA,MAAMC,WAAW;AACfC,YAAUJ,QAAQC,GAAR,CAAYC,UADP;AAEfG,QAAOL,QAAQC,GAAR,CAAYK,MAFJ;AAGfC,YAAUP,QAAQC,GAAR,CAAYO,UAHP;AAIfC,QAAMT,QAAQC,GAAR,CAAYS,MAJH;AAKfC,QAAMC,OAAQZ,QAAQC,GAAR,CAAYY,MAApB;AALS,CAAjB;;AAQA,MAAMC,gBAAgB,4BAAtB;;AAEA,MAAMC,WAAW,MAAMC,YAAOC,QAAP,CAAiBC,6BAAWH,QAA5B,EAAuChB,MAAvC,EAA+CI,QAA/C,CAAvB;;AAEA,MAAMgB,UAAU,MAAMH,YAAOC,QAAP,CAAiBC,6BAAWC,OAA5B,EAAsChB,QAAtC,EAAgDW,aAAhD,CAAtB;;AAEA,MAAMM,YAAYvB,MAAOsB,OAAP,EAAiBJ,UAAjB,CAAlB;;AAEAK,UAAUC,IAAV,CACEC,SAASC,QAAQD,KAAR,CAAgB,kCAAiCA,KAAM,EAAvD,CADX,EAEE,MAAMC,QAAQC,GAAR,CAAa,sBAAb,CAFR","file":"migrator.js","sourcesContent":["import Migrations from 'postgres-migrations';\r\nimport { S, Future } from '../fun';\r\n\r\nconst { chain } = S;\r\n\r\nconst dbName = process.env.PGDATABASE;\r\n\r\nconst dbParams = {\r\n  database: process.env.PGDATABASE,\r\n  user : process.env.PGUSER,\r\n  password: process.env.PGPASSWORD,\r\n  host: process.env.PGHOST,\r\n  port: Number (process.env.PGPORT)\r\n}\r\n\r\nconst migrationPath = 'src/persistence/migrations';\r\n\r\nconst createDb = () => Future.encaseP2 (Migrations.createDb) (dbName, dbParams);\r\n\r\nconst migrate = () => Future.encaseP2 (Migrations.migrate) (dbParams, migrationPath);\r\n\r\nconst migration = chain (migrate) (createDb ());\r\n\r\nmigration.fork (\r\n  error => console.error (`Error while running migration: ${error}`),\r\n  () => console.log ('Migration succeeded.')\r\n);"]}