{"version":3,"sources":["../../src/persistence/migrator.js"],"names":["chain","S","dbName","process","env","PGDATABASE","dbParams","database","user","PGUSER","password","PGPASSWORD","host","PGHOST","port","Number","PGPORT","migrationPath","createDb","Future","encaseP2","Migrations","migrate","fork","error","console","log"],"mappings":";;AAAA;;;;AACA;;;;AAEA,MAAM,EAAEA,KAAF,KAAYC,MAAlB;;AAEA,MAAMC,SAASC,QAAQC,GAAR,CAAYC,UAA3B;;AAEA,MAAMC,WAAW;AACfC,YAAUJ,QAAQC,GAAR,CAAYC,UADP;AAEfG,QAAOL,QAAQC,GAAR,CAAYK,MAFJ;AAGfC,YAAUP,QAAQC,GAAR,CAAYO,UAHP;AAIfC,QAAMT,QAAQC,GAAR,CAAYS,MAJH;AAKfC,QAAMC,OAAQZ,QAAQC,GAAR,CAAYY,MAApB;AALS,CAAjB;;AAQA,MAAMC,gBAAgB,4BAAtB;;AAEA,MAAMC,WAAW,MACfC,YAAOC,QAAP,CAAiBC,6BAAWH,QAA5B,EAAuChB,MAAvC,EAA+CI,QAA/C,CADF;;AAGA,MAAMgB,UAAU,MACdH,YAAOC,QAAP,CAAiBC,6BAAWC,OAA5B,EAAsChB,QAAtC,EAAgDW,aAAhD,CADF;;AAGA;AACAC,WACGlB,KADH,CACUsB,OADV,EAEGC,IAFH,CAGIC,SAASC,QAAQD,KAAR,CAAgB,kCAAiCA,KAAM,EAAvD,CAHb,EAII,MAAMC,QAAQC,GAAR,CAAa,sBAAb,CAJV","file":"migrator.js","sourcesContent":["import Migrations from 'postgres-migrations';\r\nimport { S, Future } from '../fun';\r\n\r\nconst { chain } = S;\r\n\r\nconst dbName = process.env.PGDATABASE;\r\n\r\nconst dbParams = {\r\n  database: process.env.PGDATABASE,\r\n  user : process.env.PGUSER,\r\n  password: process.env.PGPASSWORD,\r\n  host: process.env.PGHOST,\r\n  port: Number (process.env.PGPORT)\r\n}\r\n\r\nconst migrationPath = 'src/persistence/migrations';\r\n\r\nconst createDb = () => \r\n  Future.encaseP2 (Migrations.createDb) (dbName, dbParams);\r\n\r\nconst migrate = () => \r\n  Future.encaseP2 (Migrations.migrate) (dbParams, migrationPath);\r\n\r\n// execute migration\r\ncreateDb ()\r\n  .chain (migrate)\r\n  .fork (\r\n    error => console.error (`Error while running migration: ${error}`),\r\n    () => console.log ('Migration succeeded.')\r\n  );"]}